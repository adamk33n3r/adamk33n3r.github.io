// Generated by CoffeeScript 1.7.1
(function() {
  var SCROLL_DELTA_FACTOR, animate_scroll_to, check_scrolling, get_current_section, get_section_after, get_section_before, goToNextSection, goToPrevSection, handle_anchors, handle_anchors2, scrollTo, titleize;

  titleize = function(str) {
    return str.replace(/\w\S*/g, function(txt) {
      return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
  };

  handle_anchors = function() {
    var hash;
    $("a").click(function() {
      var $toElement, hash, toPosition;
      console.log("ouch", this.hash);
      if (this.hash) {
        hash = this.hash.substr(1);
        $toElement = $("[id=" + hash + "]");
        toPosition = $toElement.position().top;
        console.log("sdfkljasdfsdjafkljs", toPosition);
        $("#container").animate({
          scrollTop: toPosition
        }, 2000, "easeOutBounce");
      }
      return false;
    });
    if (location.hash) {
      hash = location.hash;
      window.scroll(0, 0);
      return $("a[href=" + hash + "]").click();
    }
  };

  animate_scroll_to = function(toY) {
    return $("#container").animate({
      scrollTop: toY
    }, 2000, "easeOutBounce");
  };

  scrollTo = function(section, pushState) {
    animate_scroll_to(section.offsetTop);
    if (pushState) {
      return history.pushState({
        section: section.id
      }, titleize(section.id), section.id);
    }
  };

  handle_anchors2 = function() {
    var section;
    if (location.pathname.length > 1) {
      section = $("[id=" + (location.pathname.substring(1)) + "]")[0];
      if (section) {
        scrollTo(section);
        history.pushState({
          section: section.id
        }, titleize(section.id), section.id);
      }
    } else {
      history.replaceState({
        section: "splash-container"
      }, "splash", "");
    }
    $("a").click(function() {
      var $section;
      section = this.getAttribute("href");
      $section = $("[id=" + section + "]");
      if ($section.length > 0) {
        scrollTo($section[0], true);
      }
      return false;
    });
    return $(window).on("popstate", function() {
      var $section;
      if (location.pathname.length > 1) {
        $section = $("[id=" + (location.pathname.substring(1)) + "]");
        if ($section.length > 0) {
          return scrollTo($section[0], false);
        }
      } else {
        return animate_scroll_to(0);
      }
    });
  };

  get_current_section = function() {
    var current_scroll, farthest;
    current_scroll = $("#container").scrollTop();
    farthest = "";
    $(".row").each(function() {
      if (current_scroll >= this.offsetTop - 100) {
        return farthest = this;
      }
    });
    return farthest;
  };

  get_section_after = function(section) {
    return $("#" + section).next(".row");
  };

  get_section_before = function(section) {
    return $("#" + section).prev(".row");
  };

  goToNextSection = function() {
    var next_section;
    next_section = get_section_after(history.state.section)[0];
    if (next_section) {
      animate_scroll_to(next_section.offsetTop);
      return history.pushState({
        section: next_section.id
      }, titleize(next_section.id), next_section.id);
    }
  };

  goToPrevSection = function() {
    var prev_section;
    prev_section = get_section_before(history.state.section)[0];
    if (prev_section) {
      animate_scroll_to(prev_section.offsetTop);
      if (prev_section.id === $(".row")[0].id) {
        return history.pushState({
          section: prev_section.id
        }, "", "/");
      } else {
        return history.pushState({
          section: prev_section.id
        }, titleize(prev_section.id), prev_section.id);
      }
    }
  };

  check_scrolling = function() {
    var current_section;
    current_section = get_current_section();
    if (history.state.section !== current_section.id) {
      if (current_section.id === $(".row")[0].id) {
        return history.pushState({
          section: current_section.id
        }, "", "/");
      } else {
        return history.pushState({
          section: current_section.id
        }, titleize(current_section.id), current_section.id);
      }
    }
  };

  SCROLL_DELTA_FACTOR = 1;

  $(function() {
    SCROLL_DELTA_FACTOR = (function() {
      switch ($.client.os) {
        case "Windows":
        case "Linux":
          return 50;
        case "Mac":
          return 1;
      }
    })();
    handle_anchors2();
    console.log(titleize("hello friend"));
    $(document.body).keydown(function(e) {
      var $container;
      $container = $("#container");
      switch (e.which) {
        case 13:
          return goToNextSection();
        case 220:
          return goToPrevSection();
        case 38:
          $container.scrollTop($container.scrollTop() - 50);
          return check_scrolling();
        case 40:
          $container.scrollTop($container.scrollTop() + 50);
          return check_scrolling();
        case 72:
          return animate_scroll_to(0);
      }
    });
    return $(document.body).mousewheel(function(e) {
      var $container, current_scroll;
      $container = $("#container");
      current_scroll = $container.scrollTop();
      $container.scrollTop(current_scroll + (SCROLL_DELTA_FACTOR * -e.deltaY));
      return check_scrolling();
    });
  });

}).call(this);
